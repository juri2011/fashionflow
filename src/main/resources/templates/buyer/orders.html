<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <meta charset="UTF-8">
    <title>구매내역</title>
    <style>
        /* 각 박스의 스타일 */
        .purchase-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        /* 상품 이미지 스타일 */
        .product-image {
            max-width: 100px;
            max-height: 100px;
        }

        /* 리뷰 남기기 버튼 스타일 */
        .review-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* 리뷰 입력 텍스트 박스 스타일 */
    .review-textbox {
        display: none;
        margin-top: 10px;
    }
    </style>
</head>
<body>

<div layout:fragment="content">

    <h1>구매내역</h1>
    <hr>

    <h2>구매완료</h2>

    <!-- 구매내역 목록 -->
    <div th:each="purchase : ${purchaseList}" class="purchase-box">
        <form th:action="@{/reviews}" method="post" th:object="${purchase}" class="purchase-form">

            <!-- 아직 이미지는 안넣어봤음
                    <img th:if="${purchase.item.itemImg.imgUrl}" th:src="${purchase.item.itemImg.imgUrl}" alt="상품 이미지" class="product-image">
            -->

            <span th:if="${purchase.item.itemName}" th:text="'상품명: ' + ${purchase.item.itemName}" ></span>
            <span th:if="${purchase.item.price}" th:text="'가격: ' + ${purchase.item.price}" ></span>
            <span th:if="${purchase.buyDate}" th:text="'거래일: ' + ${purchase.buyDate}" ></span>

            <!-- 사용한 더미데이터
            INSERT INTO Category (code, name, parent_id, list_Order) VALUES
                ('100', '의류', NULL, 1),
                ('101', '남성 의류', 1, 1),
                ('102', '여성 의류', 1, 2),
                ('103', '아동 의류', 1, 3),
                ('201', '주방 가전', 5, 1),
                ('202', '생활 가전', 5, 2);

            INSERT INTO Item (item_id, item_Name, content, price, delivery, address, regdate, category_id, member_id, item_Status, sell_Status) VALUES
                (1, '상품1', '상품1의 상세 설명입니다.', 10000, 3000, '서울시 강남구', '2024-04-29 10:00:00', 1, 1, '1', '1'),
                (2, '상품2', '상품2의 상세 설명입니다.', 20000, 5000, '서울시 서초구', '2024-04-28 15:30:00', 2, 1, '5', '1'),
                (3, '상품3', '상품3의 상세 설명입니다.', 30000, 7000, '서울시 송파구', '2024-04-27 09:45:00', 3, 1, '1', '1');

            INSERT INTO Item_Buy (item_id, member_id, buy_Date)
            VALUES
                (1, 1, '2024-04-29 10:00:00'),
                (2, 1, '2024-04-28 15:30:00'),
                (3, 1, '2024-04-27 09:45:00');
            -->

            <button type="button" class="review-button">리뷰 남기기</button>

            <!-- 리뷰 입력 텍스트 박스 -->
            <textarea class="review-textbox" name="review" placeholder="리뷰를 작성해주세요"></textarea>
            <!-- 점수 선택 드롭다운 -->
            <select class="score-dropdown" name="score" style="display: none;">
                <option value="">점수를 선택하세요</option>
                <option th:each="num : ${#numbers.sequence(1,100)}" th:value="${num}" th:text="${num}"></option>
            </select>

            <button type="submit" class="submit-review" style="display: none;">제출</button>

            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
        </form>
    </div>

</div>
</body>
</html>

<script>
    document.querySelectorAll('.review-button').forEach(function(button) {
        button.addEventListener('click', function(event) {

            event.preventDefault(); // 기본 이벤트 막기

            var form = this.closest('.purchase-form');
            var reviewTextbox = form.querySelector('.review-textbox');
            var scoreDropdown = form.querySelector('.score-dropdown'); // scoreDropdown 추가
            var submitButton = form.querySelector('.submit-review');

            reviewTextbox.style.display = 'block';
            scoreDropdown.style.display = 'block'; // 드롭다운 보이게 설정
            submitButton.style.display = 'block';
        });
    });
</script>
