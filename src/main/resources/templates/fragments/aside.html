<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="recentViewedItems">
  <div class="card recent-viewed-items">
    <div class="card-header">
      최근 본 상품
    </div>
    <ul class="recent-view list-group list-group-flush">

    </ul>
  </div>
  <style>
    .recent-viewed-items {
      position: fixed;
      top: 300px;
      right: 20px;
      width: 150px;
      min-height: 50px;
      z-index: 1000;
    }
    .recent-viewed-items img {
      width: 45px;
      height: 45px;
      float: left;
      margin-right: 10px;
    }
    .item-name span {
      color: black;
      display: -webkit-box;
      -webkit-line-clamp: 2; /* 라인 수 제한 */
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal; /* 띄어쓰기와 자동 줄바꿈 활성화 */
      max-width: 90px; /* 최대 너비 설정, 상황에 따라 조정 필요 */
    }
    .item-name a {
      text-decoration: none; /* 밑줄 없앰 */
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var recentItems = Cookies.get('recentViewedItems');

      if (recentItems) {
        try {
          var items = JSON.parse(decodeURIComponent(recentItems));
          var list = document.querySelector('.recent-view');
          items.forEach(function(item) {
            var listItem = document.createElement('li');
            listItem.className = 'recent-view-item list-group-item';
            listItem.innerHTML = '<a class="item-name" href="/item/' + item.itemId + '" style="text-decoration: none;">' +
                                 '<img src="' + (item.imgName ? '/images/' + item.imgName : '/img/default.PNG') + '" alt="상품 이미지" />' +
                                 '<span>' + decodeURIComponent(item.itemName.replace(/\+/g, ' ')) + '</span>' +
                                 '</a>';
            list.appendChild(listItem);
          });
        } catch (e) {
          console.error('최근 본 상품 목록을 불러오는 데 실패했습니다.', e);
        }
      }
    });
  </script>
</div>
</html>
