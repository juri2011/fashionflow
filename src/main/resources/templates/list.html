<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        let currentPage = 8; // 8개 다음 페이지부터 로드
        let isLoading = false;
        let isLastPage = false;
        const bufferHeight = 300; // 스크롤 끝에서 300px 전에 다음 페이지 로드

        function loadMoreProducts() {
            if(isLoading || isLastPage) return;

            isLoading = true;

            // 요청 지연 추가
            setTimeout(() => {
                fetch(`/list/more?page=${currentPage}`)
                    .then(response => response.json())
                    .then(products => {
                        if(products.length === 0) {
                            isLastPage = true;
                        }
                        products.forEach(product => {
                            const productElement = document.createElement("div");
                            productElement.classList.add("product-item");
                            productElement.innerHTML = `
                                <p>${product.id}</p>
                                <!-- 여기에 product의 다른 속성을 기반으로 한 HTML 추가 -->
                            `;
                            document.querySelector('.product-list').appendChild(productElement);
                        });
                        currentPage++; // 다음 페이지로
                        isLoading = false;
                    })
                    .catch(error => {
                        console.error('Error loading more products:', error);
                        isLoading = false;
                    });
            }, 200); // 200ms 지연
        }

        window.onscroll = function() {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - bufferHeight) {
                loadMoreProducts();
            }
        };
    </script>

    <style>


        .sidebar {
            position: fixed;
            left: 0;
            top: 30%;
            width: 200px;
            height: 100px;
            background-color: #f0f0f0;
            padding: 20px;
        }

        .product-list {
            margin-left: 220px; /* 사이드바 너비 + 여백 */
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .product-item {
            width: calc(25% - 40px); /* 한 줄에 4개씩, 양쪽 여백을 고려하여 조정 */
            height: 400px;
            margin: 10px; /* 상품 간 여백 */
            border: 1px solid #ddd; /* 사각형 박스 형태의 보더 추가 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* 상품에 그림자 효과 추가 */
            background-color: #f9f9f9;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column; /* 상품 내용을 세로로 정렬 */
            align-items: center; /* 상품 내용을 가운데 정렬 */
        }
    </style>
</head>


<body>
<div layout:fragment="content">

    <div class="sidebar">
        <h3>카테고리</h3>

    </div>
    <div class="product-list">
        <!-- 각 상품을 나타내는 HTML 요소 -->
        <div th:each="product : ${productLists}" class="product-item">
            <!-- 상품 내용 -->
            <p th:text="${product.id}"></p>
        </div>
    </div>
</div>

</body>

</html>
